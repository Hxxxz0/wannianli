# 崇新学堂开发创新实践 I esp32 万年历。
## 🌟 功能特点

### 📱 双模式Web配置
- **初始配置模式**：设备首次使用时，自动开启WiFi热点进行初始配置
- **高级设置模式**：连接WiFi后，提供完整的Web设置界面

### ⏰ 时间显示功能
- **24小时制显示**：标准的HH:MM格式
- **12小时制显示**：AM/PM格式，可通过网页设置开启
- **秒钟显示**：在详细时间页面显示精确到秒的时间

### 📅 日期功能
- **公历日期显示**：年/月/日格式
- **农历日期显示**：可通过网页设置开启/关闭
- **星期显示**：中英文星期显示

### 🌤️ 天气信息
- **实时天气**：温度、湿度、天气状况
- **天气图标**：晴天、阴天、雨天图标自动切换
- **城市设置**：支持多城市天气获取

### 🎵 音乐 & 蜂鸣器（新增）
- **背景音乐循环播放**：SPIFFS 中 `/compressed_smaller.mp3` 自动循环
- **蜂鸣器 MP3 循环**：闹钟或测试时播放 `/beep_burst.mp3`（1000 Hz 间断蜂鸣）
- **一键网页控制**：网页"播放音乐 / 停止播放"按钮即刻生效
- **无卡顿切换**：改用单线程 AudioTask，停止 – 再播放不卡顿、不重启

### 🌡️ 温湿度监测
- **本地DHT11**：内置 DHT11 传感器，实时采集室内温度与湿度
- **设备状态页查看**：在"设备信息"页面实时查看环境数据

### 🎨 页面功能
- **多页面切换**：主页面、天气页面、闹钟页面、事件提醒页面、时间详情、农历页面、网络信息页面、模拟时钟页面
- **自动轮转**：可设置自动轮转页面和间隔时间
- **按键控制**：左右键切换页面，中键回到主页

### ⏰ 闹钟与事件提醒
- **多闹钟**：支持最多 3 组闹钟，自定义时间与标签
- **事件提醒**：支持 4 条重要事件（生日、纪念日等）提前/按时提醒
- **蜂鸣器提示**：闹钟触发时自动蜂鸣，并进入报警页面

## 🔧 使用步骤

### 第一步：初始配置

1. **连接热点**
   - 设备开机后会自动创建名为 `TV-PRO` 的WiFi热点
   - 使用手机/电脑连接此热点（无密码）

2. **访问配置页面**
   - 打开浏览器访问：`http://192.168.4.1`
   - 填写您的WiFi网络信息

3. **基础设置**
   - WiFi名称（必填）
   - WiFi密码
   - 天气API密钥（可选）
   - 城市名称（可选）

### 第二步：高级设置（连接WiFi后）

设备连接到您的WiFi网络后，可以通过以下方式访问高级设置：

1. **获取设备IP地址**
   - **推荐方式**：在设备上按右键4次，切换到"网络信息页面"查看IP地址
   - **启动显示**：设备WiFi连接成功后，屏幕会显示5秒钟IP地址信息
   - **路由器查看**：查看路由器管理界面，找到"TV-PRO"设备
   - **串口监视器**：在串口监视器中查看显示的IP地址

2. **访问设置页面**
   - 在浏览器中访问：`http://[设备IP地址]`
   - 例如：`http://192.168.1.100`

## 🎯 网页设置功能详解

### 🌐 网络配置
- **更改WiFi**：可以重新设置WiFi网络
- **网络状态**：查看当前连接状态和信号强度

### 🌤️ 天气配置
- **城市设置**：输入城市拼音（如：beijing、shanghai）
- **API配置**：设置心知天气API密钥
- **实时更新**：设置后立即获取最新天气

### 🎨 显示设置

#### AM/PM显示设置
- ✅ **启用12小时制**：勾选后时间显示为AM/PM格式
- ❌ **24小时制**：默认显示24小时制格式
- **示例**：
  - 24小时制：`14:30`
  - 12小时制：`2:30 PM`

#### 农历显示设置
- ✅ **显示农历**：在主页面和农历页面显示农历日期
- ❌ **隐藏农历**：只显示公历日期
- **显示位置**：
  - 主页面：公历日期下方显示农历
  - 农历页面：详细的农历信息

#### 自动轮转设置
- ✅ **自动轮转**：启用页面自动切换
- **轮转间隔**：5秒/10秒/15秒/30秒可选
- **轮转顺序**：主页面 → 天气页面 → 时间详情 → 农历页面 → 网络信息页面

### 📊 设备信息
- **设备IP**：当前设备的IP地址
- **WiFi信号**：信号强度显示
- **运行时间**：设备运行时长
- **当前天气**：实时天气信息

## 🎮 按键操作

- **左键**：切换到上一页面
- **右键**：切换到下一页面  
- **中键短按**：回到主页面
- **中键长按（2秒）**：进入配置模式

## 📱 页面说明

### 主页面（Page 0）
- 大时钟显示（24小时制或AM/PM）
- 日期 + 农历（可选）
- 天气图标及城市、温度、湿度
- 室内温湿度（DHT11 实时数据）

### 天气详情页面（Page 1）
- 详细天气信息（状况、温度、湿度）
- 城市名称与对应图标

### 闹钟页面（Page 2）
- 列出所有启用的闹钟（时间 + 标签）
- 显示闹钟启用状态

### 事件提醒页面（Page 3）
- 滚动显示最近或当天事件
- 支持全天/定时事件提醒

### 网络信息页面（Page 4）
- WiFi 连接状态与 SSID
- 设备 IP 地址（大字体）
- 信号强度评估
- Web 设置入口

### 模拟时钟页面（Page 5）
- 经典指针式模拟时钟
- 自动匹配 12/24 小时制

### 报警页面（系统自动）
- 闹钟触发后自动进入
- 显示闹钟标签并持续蜂鸣，按键停止

## 🔧 高级功能

### 网页API接口
- `GET /`：访问设置主页面
- `POST /wifi`：更新WiFi设置
- `POST /weather`：更新天气设置  
- `POST /display`：更新显示设置
- `GET /alarms` / `POST /save-alarms`：获取与保存闹钟设置
- `GET /events` / `POST /save-events`：获取与保存事件提醒
- `GET /beep-start` / `GET /beep-stop`：蜂鸣器连续测试开/关
- `GET /restart`：重启设备

### 配置文件
- `/ssid.json`：WiFi 和天气配置
- `/settings.json`：显示设置配置
- `/alarms.json`：闹钟配置
- `/events.json`：事件提醒配置

## 📝 注意事项

1. **天气API**：需要在心知天气官网注册获取免费API密钥
2. **农历显示**：目前支持2024年农历数据，其他年份为估算值
3. **自动保存**：所有设置自动保存到设备存储中
4. **网络要求**：需要稳定的WiFi网络连接以获取时间和天气
5. **重启生效**：部分设置可能需要重启设备后生效

## 🚀 快速设置示例

### 设置AM/PM显示
1. 连接设备WiFi网络
2. 访问设备IP地址
3. 在"显示设置"中勾选"使用12小时制（AM/PM格式）"
4. 点击"更新显示设置"
5. 主页面时间立即切换为AM/PM格式

### 设置农历显示
1. 访问设备设置页面
2. 在"显示设置"中勾选"显示农历日期"
3. 点击"更新显示设置"
4. 主页面将在日期下方显示农历
5. 可通过按键切换到农历页面查看详细信息

### 设置自动轮转
1. 访问设备设置页面
2. 勾选"自动轮转页面"
3. 选择轮转间隔（推荐10秒）
4. 点击"更新显示设置"
5. 设备将自动在各页面间轮转显示

### 上传/替换音频文件（新增）
1. 将 `compressed_smaller.mp3` 或自定义音乐、`beep_burst.mp3` 复制到 `data/` 目录
2. VSCode 中 PlatformIO 运行 `Upload File System image`
3. 重启设备即可生效

## 📞 技术支持

如有问题，请检查：
1. WiFi连接是否稳定
2. 设备IP地址是否正确
3. 浏览器是否支持现代Web标准
4. 设置是否正确保存

设备状态可通过串口监视器查看详细调试信息。 